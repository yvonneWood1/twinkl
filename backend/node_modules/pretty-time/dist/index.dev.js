/*!
 * pretty-time <https://github.com/jonschlinkert/pretty-time>
 *
 * Copyright (c) 2015-2018, present, Jon Schlinkert.
 * Released under the MIT License.
 */
'use strict';

var utils = require('./utils');

module.exports = function (time, smallest, digits) {
  var isNumber = /^[0-9]+$/.test(time);

  if (!isNumber && !Array.isArray(time)) {
    throw new TypeError('expected an array or number in nanoseconds');
  }

  if (Array.isArray(time) && time.length !== 2) {
    throw new TypeError('expected an array from process.hrtime()');
  }

  if (/^[0-9]+$/.test(smallest)) {
    digits = smallest;
    smallest = null;
  }

  var num = isNumber ? time : utils.nano(time);
  var res = '';
  var prev;

  for (var _i = 0, _Object$keys = Object.keys(utils.scale); _i < _Object$keys.length; _i++) {
    var uom = _Object$keys[_i];
    var step = utils.scale[uom];
    var inc = num / step;

    if (smallest && utils.isSmallest(uom, smallest)) {
      inc = utils.round(inc, digits);
      if (prev && inc === prev / step) --inc;
      res += inc + uom;
      return res.trim();
    }

    if (inc < 1) continue;

    if (!smallest) {
      inc = utils.round(inc, digits);
      res += inc + uom;
      return res;
    }

    prev = step;
    inc = Math.floor(inc);
    num -= inc * step;
    res += inc + uom + ' ';
  }

  return res.trim();
};